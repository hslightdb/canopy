<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Table Management &mdash; Canopy 10.2 documentation</title>
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/citus.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/flexboxgrid.min.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/pygments.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Query Performance Tuning" href="../performance/performance_tuning.html" />
    <link rel="prev" title="Cluster Management" href="cluster_management.html" />
  
  <script>
    /*
      Global variable shared with cookie consent dialog code.
      This is to use its value uniformly throughout the page.
    */
    window.g_cookieConsentId = 'CitusCookieConsentCorner';

    if (document.cookie.indexOf(window.g_cookieConsentId) == -1) {
      window.YETT_BLACKLIST = [
        /munchkin\.marketo\.net/,
        /sjs\.bizographics\.com/,
        /doubleclick\.net/,
        /cdn\.heapanalytics\.com/,
      ];
    } else {
      console.log("Cookies already accepted");
      window.YETT_BLACKLIST = [ ];
    }
  </script>
  <script src='https://unpkg.com/yett'></script>

   

  
  <script>
    // Read The Docs is responsible for loading GA by
    // injecting a script into all pages. The function
    // below assumes that this has happened.
    window.trackOutboundLink = function(url) {
      if (typeof(ga) == 'function') {
        ga('send', 'event', 'outbound', 'click', url, {
          'transport': 'beacon',
          'hitCallback': function(){document.location = url;}
        });
        // cancel navigation due to click, allow the hitCallback to
        // navigate to the next page after ga() has registered event
        return false;
      } else {
        console.log("trackOutboundLink: Unable to access ga()");
        // ga() was a no-go so allow navigation to proceed
        return true;
      }
    };
  </script>

  
  <meta name="google-site-verification" content="v8MtCUC2nV2dO-4CSGb5flD1MyPKJvw7wBDOYRwBadw" />

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">

  
  

  
  <meta property="og:image" content="https://docs.citusdata.com/en/stable/_images/citus-docs-og-logo.png" />
  <meta property="og:title" content="Table Management - Canopy 10.2 documentation" />
  <meta property="og:description" content="Docs for the Citus extension to Postgres. Citus distributes your data &amp; queries across multiple nodes in a cluster, so your database can scale and your queries are fast." />

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
  <a class="skiplink" href="#maincontent">Skip to main content ></a>
  <a href="https://citusdata.com" class="homepage">
    <img src=../_images/logo.png class="logo" alt="Citus Data logo" />
  </a>

  
            <a href="../index.html" class="icon icon-home"> Canopy
          </a>
              <div class="version">
                10.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" id="main-search" autocomplete="off" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Main">
              <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/what_is_citus.html">What is Canopy?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../get_started/what_is_citus.html#how-far-can-canopy-scale">How Far Can Canopy Scale?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/what_is_citus.html#when-to-use-canopy">When to Use Canopy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../get_started/what_is_citus.html#multi-tenant-database">Multi-Tenant Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get_started/what_is_citus.html#real-time-analytics">Real-Time Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get_started/what_is_citus.html#considerations-for-use">Considerations for Use</a></li>
<li class="toctree-l2"><a class="reference internal" href="../get_started/what_is_citus.html#when-canopy-is-inappropriate">When Canopy is Inappropriate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../get_started/tutorials.html">Quick Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../get_started/tutorial_multi_tenant.html">Multi-tenant Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_multi_tenant.html#data-model-and-sample-data">Data model and sample data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_multi_tenant.html#creating-tables">Creating tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_multi_tenant.html#distributing-tables-and-loading-data">Distributing tables and loading data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_multi_tenant.html#running-queries">Running queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../get_started/tutorial_realtime_analytics.html">Real-time Analytics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_realtime_analytics.html#data-model-and-sample-data">Data model and sample data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_realtime_analytics.html#creating-tables">Creating tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_realtime_analytics.html#distributing-tables-and-loading-data">Distributing tables and loading data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/tutorial_realtime_analytics.html#running-queries">Running queries</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Install</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/single_node.html">Single-Node Canopy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/single_node_rhel.html">CentOS or Red Hat</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation/multi_node.html">Multi-Node Canopy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/multi_node_rhel.html">CentOS or Red Hat</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation/multi_node_rhel.html#steps-to-be-executed-on-all-nodes">Steps to be executed on all nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation/multi_node_rhel.html#steps-to-be-executed-on-the-coordinator-node">Steps to be executed on the coordinator node</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Use-Case Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/multi_tenant.html">Multi-tenant Applications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#let-s-make-an-app-ad-analytics">Let’s Make an App – Ad Analytics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#scaling-the-relational-data-model">Scaling the Relational Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#preparing-tables-and-ingesting-data">Preparing Tables and Ingesting Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../use_cases/multi_tenant.html#try-it-yourself">Try it Yourself</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#integrating-applications">Integrating Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#sharing-data-between-tenants">Sharing Data Between Tenants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#online-changes-to-the-schema">Online Changes to the Schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#when-data-differs-across-tenants">When Data Differs Across Tenants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#scaling-hardware-resources">Scaling Hardware Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/multi_tenant.html#where-to-go-from-here">Where to Go From Here</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/realtime_analytics.html">Real-Time Dashboards</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/realtime_analytics.html#data-model">Data Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/realtime_analytics.html#rollups">Rollups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/realtime_analytics.html#expiring-old-data">Expiring Old Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/realtime_analytics.html#approximate-distinct-counts">Approximate Distinct Counts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/realtime_analytics.html#unstructured-data-with-jsonb">Unstructured Data with JSONB</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../use_cases/timeseries.html">Timeseries Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/timeseries.html#scaling-timeseries-data-on-canopy">Scaling Timeseries Data on Canopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/timeseries.html#automating-partition-creation">Automating Partition Creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use_cases/timeseries.html#archiving-with-columnar-storage">Archiving with Columnar Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../use_cases/timeseries.html#archiving-a-row-partition-to-columnar-storage">Archiving a Row Partition to Columnar Storage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architecture</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../get_started/concepts.html">Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../get_started/concepts.html#nodes">Nodes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../get_started/concepts.html#coordinator-and-workers">Coordinator and Workers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../get_started/concepts.html#distributed-data">Distributed Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../get_started/concepts.html#table-types">Table Types</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../get_started/concepts.html#type-1-distributed-tables">Type 1: Distributed Tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../get_started/concepts.html#type-2-reference-tables">Type 2: Reference Tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../get_started/concepts.html#type-3-local-tables">Type 3: Local Tables</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/concepts.html#shards">Shards</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../get_started/concepts.html#shard-placements">Shard Placements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/concepts.html#co-location">Co-Location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../get_started/concepts.html#parallelism">Parallelism</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../get_started/concepts.html#query-execution">Query Execution</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Develop</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../develop/app_type.html">Determining Application Type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../develop/app_type.html#at-a-glance">At a Glance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../develop/app_type.html#examples-and-characteristics">Examples and Characteristics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sharding/data_modeling.html">Choosing Distribution Column</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../sharding/data_modeling.html#multi-tenant-apps">Multi-Tenant Apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sharding/data_modeling.html#real-time-apps">Real-Time Apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#id1">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sharding/data_modeling.html#timeseries-data">Timeseries Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#id2">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../sharding/data_modeling.html#table-co-location">Table Co-Location</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#data-co-location-in-canopy-for-hash-distributed-tables">Data co-location in Canopy for hash-distributed tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#a-practical-example-of-co-location">A practical example of co-location</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#using-regular-lightdb-tables">Using Regular LightDB Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#distributing-tables-by-id">Distributing tables by ID</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#distributing-tables-by-tenant">Distributing tables by tenant</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#co-location-means-better-feature-support">Co-location means better feature support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sharding/data_modeling.html#query-performance">Query Performance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop/migration.html">Migrating an Existing App</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../develop/migration_mt_schema.html">Identify Distribution Strategy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_schema.html#pick-distribution-key">Pick distribution key</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_schema.html#identify-types-of-tables">Identify types of tables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/migration_mt_schema.html#prepare-source-tables-for-migration">Prepare Source Tables for Migration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_schema.html#add-distribution-keys">Add distribution keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_schema.html#backfill-newly-created-columns">Backfill newly created columns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/migration_mt_query.html">Prepare Application for Canopy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_query.html#set-up-development-canopy-cluster">Set up Development Canopy Cluster</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/migration_mt_query.html#include-distribution-column-in-keys">Include distribution column in keys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_query.html#add-distribution-key-to-queries">Add distribution key to queries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/migration_mt_ror.html">Ruby on Rails</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/migration_mt_django.html">Django</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/migration_mt_asp.html">ASP.NET</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/migration_mt_query.html#other-sql-principles">Other (SQL Principles)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_query.html#enable-secure-connections">Enable Secure Connections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_mt_query.html#check-for-cross-node-traffic">Check for cross-node traffic</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/migration_data.html">Migrate Production Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/migration_data_small.html">Small Database Migration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop/reference.html">SQL Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_ddl.html">Creating and Modifying Distributed Tables (DDL)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_ddl.html#creating-and-distributing-tables">Creating And Distributing Tables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#reference-tables">Reference Tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#distributing-coordinator-data">Distributing Coordinator Data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_ddl.html#co-locating-tables">Co-Locating Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_ddl.html#dropping-tables">Dropping Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_ddl.html#modifying-tables">Modifying Tables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#adding-modifying-columns">Adding/Modifying Columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#adding-removing-constraints">Adding/Removing Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#using-not-valid-constraints">Using NOT VALID Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#adding-removing-indices">Adding/Removing Indices</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_ddl.html#manual-modification">Manual Modification</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_dml.html">Ingesting, Modifying Data (DML)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_dml.html#inserting-data">Inserting Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_dml.html#from-select-clause-distributed-rollups">“From Select” Clause (Distributed Rollups)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_dml.html#copy-command-bulk-load">COPY Command (Bulk load)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_dml.html#caching-aggregations-with-rollups">Caching Aggregations with Rollups</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_dml.html#updates-and-deletion">Updates and Deletion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_dml.html#maximizing-write-performance">Maximizing Write Performance</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_sql.html">Querying Distributed Tables (SQL)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_sql.html#aggregate-functions">Aggregate Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_sql.html#count-distinct-aggregates">Count (Distinct) Aggregates</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_sql.html#estimating-top-n-items">Estimating Top N Items</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_sql.html#percentile-calculations">Percentile Calculations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_sql.html#limit-pushdown">Limit Pushdown</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_sql.html#views-on-distributed-tables">Views on Distributed Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_sql.html#joins">Joins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_sql.html#co-located-joins">Co-located joins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_sql.html#reference-table-joins">Reference table joins</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_sql.html#repartition-joins">Repartition joins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_processing.html">Query Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_processing.html#distributed-query-planner">Distributed Query Planner</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_processing.html#distributed-query-executor">Distributed Query Executor</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_processing.html#subquery-cte-push-pull-execution">Subquery/CTE Push-Pull Execution</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_processing.html#lightdb-planner-and-executor">LightDB planner and executor</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_propagation.html">Manual Query Propagation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_propagation.html#running-on-all-workers">Running on all Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_propagation.html#running-on-all-shards">Running on all Shards</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_propagation.html#running-on-all-placements">Running on all Placements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_propagation.html#limitations">Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/reference_workarounds.html">SQL Support and Workarounds</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/reference_workarounds.html#workarounds">Workarounds</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_workarounds.html#work-around-limitations-using-ctes">Work around limitations using CTEs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/reference_workarounds.html#temp-tables-the-workaround-of-last-resort">Temp Tables: the Workaround of Last Resort</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop/api.html">Canopy API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../develop/api_udf.html">Canopy Utility Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_udf.html#table-and-shard-ddl">Table and Shard DDL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#create-distributed-table">create_distributed_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#truncate-local-data-after-distributing-table">truncate_local_data_after_distributing_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#undistribute-table">undistribute_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#alter-distributed-table">alter_distributed_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#alter-table-set-access-method">alter_table_set_access_method</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#remove-local-tables-from-metadata">remove_local_tables_from_metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#create-reference-table">create_reference_table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#mark-tables-colocated">mark_tables_colocated</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#update-distributed-table-colocation">update_distributed_table_colocation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#create-distributed-function">create_distributed_function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#master-create-empty-shard">master_create_empty_shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#alter-columnar-table-set">alter_columnar_table_set</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#create-time-partitions">create_time_partitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#drop-old-time-partitions">drop_old_time_partitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#alter-old-partitions-set-access-method">alter_old_partitions_set_access_method</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_udf.html#table-and-shard-dml">Table and Shard DML</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#master-append-table-to-shard">master_append_table_to_shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#master-apply-delete-command">master_apply_delete_command</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_udf.html#metadata-configuration-information">Metadata / Configuration Information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-add-node">canopy_add_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-update-node">canopy_update_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-set-node-property">canopy_set_node_property</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-add-inactive-node">canopy_add_inactive_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-activate-node">canopy_activate_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-disable-node">canopy_disable_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-add-secondary-node">canopy_add_secondary_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-remove-node">canopy_remove_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-get-active-worker-nodes">canopy_get_active_worker_nodes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-set-coordinator-host">canopy_set_coordinator_host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#master-get-table-metadata">master_get_table_metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#get-shard-id-for-distribution-column">get_shard_id_for_distribution_column</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#column-to-column-name">column_to_column_name</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-relation-size">canopy_relation_size</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-table-size">canopy_table_size</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-total-relation-size">canopy_total_relation_size</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_udf.html#cluster-management-and-repair-functions">Cluster Management And Repair Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-copy-shard-placement">canopy_copy_shard_placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-move-shard-placement">canopy_move_shard_placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#rebalance-table-shards">rebalance_table_shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#get-rebalance-table-shards-plan">get_rebalance_table_shards_plan</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#get-rebalance-progress">get_rebalance_progress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-add-rebalance-strategy">canopy_add_rebalance_strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-set-default-rebalance-strategy">canopy_set_default_rebalance_strategy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-remote-connection-stats">canopy_remote_connection_stats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-drain-node">canopy_drain_node</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#replicate-table-shards">replicate_table_shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_udf.html#canopy-create-restore-point">canopy_create_restore_point</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/api_metadata.html">Canopy Tables and Views</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_metadata.html#coordinator-metadata">Coordinator Metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#partition-table">Partition table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#shard-table">Shard table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#shard-information-view">Shard information view</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#shard-placement-table">Shard placement table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#worker-node-table">Worker node table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#distributed-object-table">Distributed object table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#canopy-tables-view">Canopy tables view</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#time-partitions-view">Time partitions view</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#co-location-group-table">Co-location group table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#rebalancer-strategy-table">Rebalancer strategy table</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_metadata.html#distributed-query-activity">Distributed Query Activity</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/api_guc.html">Configuration Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_guc.html#general-configuration">General configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-max-worker-nodes-tracked-integer">canopy.max_worker_nodes_tracked (integer)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-use-secondary-nodes-enum">canopy.use_secondary_nodes (enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-cluster-name-text">canopy.cluster_name (text)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-enable-version-checks-boolean">canopy.enable_version_checks (boolean)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-log-distributed-deadlock-detection-boolean">canopy.log_distributed_deadlock_detection (boolean)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-distributed-deadlock-detection-factor-floating-point">canopy.distributed_deadlock_detection_factor (floating point)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-node-connection-timeout-integer">canopy.node_connection_timeout (integer)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-node-conninfo-text">canopy.node_conninfo (text)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-local-hostname-text">canopy.local_hostname (text)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_guc.html#data-loading">Data Loading</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-multi-shard-commit-protocol-enum">canopy.multi_shard_commit_protocol (enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-shard-replication-factor-integer">canopy.shard_replication_factor (integer)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-shard-count-integer">canopy.shard_count (integer)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-shard-max-size-integer">canopy.shard_max_size (integer)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-replicate-reference-tables-on-activate-boolean">canopy.replicate_reference_tables_on_activate (boolean)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_guc.html#planner-configuration">Planner Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-local-table-join-policy-enum">canopy.local_table_join_policy (enum)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-limit-clause-row-fetch-count-integer">canopy.limit_clause_row_fetch_count (integer)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-count-distinct-error-rate-floating-point">canopy.count_distinct_error_rate (floating point)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-task-assignment-policy-enum">canopy.task_assignment_policy (enum)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_guc.html#intermediate-data-transfer">Intermediate Data Transfer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-binary-worker-copy-format-boolean">canopy.binary_worker_copy_format (boolean)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-max-intermediate-result-size-integer">canopy.max_intermediate_result_size (integer)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_guc.html#ddl">DDL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-enable-ddl-propagation-boolean">canopy.enable_ddl_propagation (boolean)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#canopy-enable-local-reference-table-foreign-keys-boolean">canopy.enable_local_reference_table_foreign_keys (boolean)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/api_guc.html#executor-configuration">Executor Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#general">General</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/api_guc.html#explain-output">Explain output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/append.html">Append Distribution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/append.html#creating-and-distributing-tables">Creating and Distributing Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/append.html#expiring-data">Expiring Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/append.html#deleting-data">Deleting Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/append.html#dropping-tables">Dropping Tables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../develop/append.html#data-loading">Data Loading</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/append.html#bulk-load-using-copy">Bulk load using \copy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/append.html#incremental-loads-by-appending-to-existing-shards">Incremental loads by appending to existing shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/append.html#increasing-data-loading-performance">Increasing data loading performance</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../develop/append.html#scaling-data-ingestion">Scaling Data Ingestion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../develop/append.html#coordinator-node-bulk-ingestion-100k-s-200k-s">Coordinator Node Bulk Ingestion (100k/s-200k/s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/append.html#worker-node-bulk-ingestion-100k-s-1m-s">Worker Node Bulk Ingestion (100k/s-1M/s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../develop/append.html#pre-processing-data-in-canopy">Pre-processing Data in Canopy</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../develop/integrations.html">External Integrations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../develop/integrations.html#ingesting-data-from-kafka">Ingesting Data from Kafka</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../develop/integrations.html#caveats">Caveats</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../develop/integrations.html#ingesting-data-from-spark">Ingesting Data from Spark</a></li>
<li class="toctree-l2"><a class="reference internal" href="../develop/integrations.html#business-intelligence-with-tableau">Business Intelligence with Tableau</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Administer</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="cluster_management.html">Cluster Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#choosing-cluster-size">Choosing Cluster Size</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#shard-count">Shard Count</a><ul>
<li class="toctree-l4"><a class="reference internal" href="cluster_management.html#multi-tenant-saas-use-case">Multi-Tenant SaaS Use-Case</a></li>
<li class="toctree-l4"><a class="reference internal" href="cluster_management.html#real-time-analytics-use-case">Real-Time Analytics Use-Case</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#initial-hardware-size">Initial Hardware Size</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#id2">Multi-Tenant SaaS Use-Case</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#id3">Real-Time Analytics Use-Case</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#scaling-the-cluster">Scaling the cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#add-a-worker">Add a worker</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#rebalance-shards">Rebalance Shards</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#adding-a-coordinator">Adding a coordinator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#dealing-with-node-failures">Dealing With Node Failures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#worker-node-failures">Worker Node Failures</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#coordinator-node-failures">Coordinator Node Failures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#resource-conservation">Resource Conservation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#limiting-long-running-queries">Limiting Long-Running Queries</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#security">Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#connection-management">Connection Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#setup-certificate-authority-signed-certificates">Setup Certificate Authority signed certificates</a></li>
<li class="toctree-l3"><a class="reference internal" href="cluster_management.html#increasing-worker-security">Increasing Worker Security</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#lightdb-extensions">LightDB extensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="cluster_management.html#creating-a-new-database">Creating a New Database</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Table Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#determining-table-and-relation-size">Determining Table and Relation Size</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vacuuming-distributed-tables">Vacuuming Distributed Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#analyzing-distributed-tables">Analyzing Distributed Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#columnar-storage">Columnar Storage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#measuring-compression">Measuring compression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gotchas">Gotchas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Troubleshoot</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../performance/performance_tuning.html">Query Performance Tuning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../performance/performance_tuning.html#table-distribution-and-shards">Table Distribution and Shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/performance_tuning.html#lightdb-tuning">LightDB tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/performance_tuning.html#scaling-out-performance">Scaling Out Performance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../performance/performance_tuning.html#distributed-query-performance-tuning">Distributed Query Performance Tuning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../performance/performance_tuning.html#general">General</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#subquery-cte-network-overhead">Subquery/CTE Network Overhead</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../performance/performance_tuning.html#advanced">Advanced</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#connection-management">Connection Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#task-assignment-policy">Task Assignment Policy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#intermediate-data-transfer-format">Intermediate Data Transfer Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#binary-protocol">Binary protocol</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../performance/performance_tuning.html#scaling-out-data-ingestion">Scaling Out Data Ingestion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../performance/performance_tuning.html#real-time-insert-and-updates">Real-time Insert and Updates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#insert-throughput">Insert Throughput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#update-throughput">Update Throughput</a></li>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#insert-and-update-throughput-checklist">Insert and Update: Throughput Checklist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../performance/performance_tuning.html#insert-and-update-latency">Insert and Update: Latency</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../performance/performance_tuning.html#staging-data-temporarily">Staging Data Temporarily</a></li>
<li class="toctree-l3"><a class="reference internal" href="../performance/performance_tuning.html#bulk-copy-250k-2m-s">Bulk Copy (250K - 2M/s)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="diagnostic_queries.html">Useful Diagnostic Queries</a><ul>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#finding-which-shard-contains-data-for-a-specific-tenant">Finding which shard contains data for a specific tenant</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#finding-the-distribution-column-for-a-table">Finding the distribution column for a table</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#detecting-locks">Detecting locks</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#querying-the-size-of-your-shards">Querying the size of your shards</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#querying-the-size-of-all-distributed-tables">Querying the size of all distributed tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#determining-replication-factor-per-table">Determining Replication Factor per Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#identifying-unused-indices">Identifying unused indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#monitoring-client-connection-count">Monitoring client connection count</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#viewing-system-queries">Viewing system queries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="diagnostic_queries.html#active-queries">Active queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="diagnostic_queries.html#why-are-queries-waiting">Why are queries waiting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#index-hit-rate">Index hit rate</a></li>
<li class="toctree-l2"><a class="reference internal" href="diagnostic_queries.html#cache-hit-rate">Cache hit rate</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/common_errors.html">Common Error Messages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#could-not-receive-query-results">Could not receive query results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#resolution">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#canceling-the-transaction-since-it-was-involved-in-a-distributed-deadlock">Canceling the transaction since it was involved in a distributed deadlock</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id1">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#could-not-connect-to-server-cannot-assign-requested-address">Could not connect to server: Cannot assign requested address</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id2">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#ssl-error-certificate-verify-failed">SSL error: certificate verify failed</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id3">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#could-not-connect-to-any-active-placements">Could not connect to any active placements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id4">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#remaining-connection-slots-are-reserved-for-non-replication-superuser-connections">Remaining connection slots are reserved for non-replication superuser connections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id5">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#pgbouncer-cannot-connect-to-server">PgBouncer cannot connect to server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id6">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#cannot-create-uniqueness-constraint">Cannot create uniqueness constraint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id7">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#function-create-distributed-table-does-not-exist">Function create_distributed_table does not exist</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id8">Resolution</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/common_errors.html#stable-functions-used-in-update-queries-cannot-be-called-with-column-references">STABLE functions used in UPDATE queries cannot be called with column references</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/common_errors.html#id9">Resolution</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">FAQ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq/faq.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#can-i-create-primary-keys-on-distributed-tables">Can I create primary keys on distributed tables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-do-i-add-nodes-to-an-existing-canopy-cluster">How do I add nodes to an existing Canopy cluster?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-does-canopy-handle-failure-of-a-worker-node">How does Canopy handle failure of a worker node?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-does-canopy-handle-failover-of-the-coordinator-node">How does Canopy handle failover of the coordinator node?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#are-there-any-lightdb-features-not-supported-by-canopy">Are there any LightDB features not supported by Canopy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-do-i-choose-the-shard-count-when-i-hash-partition-my-data">How do I choose the shard count when I hash-partition my data?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-do-i-change-the-shard-count-for-a-hash-partitioned-table">How do I change the shard count for a hash partitioned table?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-does-canopy-support-count-distinct-queries">How does canopy support count(distinct) queries?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#in-which-situations-are-uniqueness-constraints-supported-on-distributed-tables">In which situations are uniqueness constraints supported on distributed tables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#how-do-i-create-database-roles-functions-extensions-etc-in-a-canopy-cluster">How do I create database roles, functions, extensions etc in a Canopy cluster?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#what-if-a-worker-node-s-address-changes">What if a worker node’s address changes?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#which-shard-contains-data-for-a-particular-tenant">Which shard contains data for a particular tenant?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#i-forgot-the-distribution-column-of-a-table-how-do-i-find-it">I forgot the distribution column of a table, how do I find it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#can-i-distribute-a-table-by-multiple-keys">Can I distribute a table by multiple keys?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#why-does-pg-relation-size-report-zero-bytes-for-a-distributed-table">Why does pg_relation_size report zero bytes for a distributed table?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#why-am-i-seeing-an-error-about-max-intermediate-result-size">Why am I seeing an error about max_intermediate_result_size?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../faq/faq.html#can-i-shard-by-schema-on-canopy-for-multi-tenant-applications">Can I shard by schema on Canopy for multi-tenant applications?</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Articles</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../articles/index.html">Related Articles</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../articles/parallel_indexing.html">LightDB Parallel Indexing in Canopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../articles/aggregation.html">Real-time Event Aggregation at Scale Using LightDB with Canopy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../articles/outer_joins.html">How Distributed Outer Joins on LightDB with Canopy Work</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../articles/outer_joins.html#distributed-outer-joins-with-canopy">Distributed Outer Joins with Canopy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../articles/designing_saas.html">Designing your SaaS Database for Scale with LightDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../articles/sharding_mt_app.html">Sharding a Multi-Tenant App with LightDB</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../articles/sharding_mt_app.html#tenancy">Tenancy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../articles/sharding_mt_app.html#multi-tenancy-and-co-location-a-perfect-pair">Multi-tenancy and co-location, a perfect pair</a></li>
<li class="toctree-l3"><a class="reference internal" href="../articles/sharding_mt_app.html#in-conclusion">In conclusion</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../articles/semi_structured_data.html">Sharding LightDB with Semi-Structured Data and Its Performance Implications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../articles/semi_structured_data.html#one-large-table-without-joins">One large table, without joins</a></li>
<li class="toctree-l3"><a class="reference internal" href="../articles/semi_structured_data.html#enter-canopy">Enter Canopy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../articles/semi_structured_data.html#the-query-workload">The query workload</a></li>
<li class="toctree-l3"><a class="reference internal" href="../articles/semi_structured_data.html#every-distribution-has-its-thorns">Every distribution has its thorns</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../articles/faceted_search.html">Scalable Real-time Product Search using LightDB with Canopy</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" aria-label="Top" >
          <button data-toggle="wy-nav-top" class="fa fa-bars"></button>
          <a href="../index.html">Canopy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          

<div role="navigation" aria-label="Breadcrumbs">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Documentation home page"></a> &raquo;</li>
      <li>Table Management</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div id="maincontent" />

  
  <div class="section" id="table-management">
<h1>Table Management<a class="headerlink" href="#table-management" title="Permalink to this headline"></a></h1>
<div class="section" id="determining-table-and-relation-size">
<span id="table-size"></span><h2>Determining Table and Relation Size<a class="headerlink" href="#determining-table-and-relation-size" title="Permalink to this headline"></a></h2>
<p>The usual way to find table sizes in LightDB, <code class="code docutils literal notranslate"><span class="pre">pg_total_relation_size</span></code>, drastically under-reports the size of distributed tables. All this function does on a Canopy cluster is reveal the size of tables on the coordinator node. In reality the data in distributed tables lives on the worker nodes (in shards), not on the coordinator. A true measure of distributed table size is obtained as a sum of shard sizes. Canopy provides helper functions to query this information.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 41%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>UDF</p></th>
<th class="head"><p>Returns</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>canopy_relation_size(relation_name)</p></td>
<td><ul class="simple">
<li><p>Size of actual data in table (the “<a class="reference external" href="https://www.hs.net/lightdb/docs/html/storage-file-layout.html">main fork</a>”).</p></li>
<li><p>A relation can be the name of a table or an index.</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p>canopy_table_size(relation_name)</p></td>
<td><ul>
<li><p>canopy_relation_size plus:</p>
<blockquote>
<div><ul class="simple">
<li><p>size of <a class="reference external" href="https://www.hs.net/lightdb/docs/html/storage-fsm.html">free space map</a></p></li>
<li><p>size of <a class="reference external" href="https://www.hs.net/lightdb/docs/html/storage-vm.html">visibility map</a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p>canopy_total_relation_size(relation_name)</p></td>
<td><ul>
<li><p>canopy_table_size plus:</p>
<blockquote>
<div><ul class="simple">
<li><p>size of indices</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>These functions are analogous to three of the standard LightDB <a class="reference external" href="https://www.hs.net/lightdb/docs/html/functions-admin.html#FUNCTIONS-ADMIN-DBSIZE">object size functions</a>, with the additional note that</p>
<ul class="simple">
<li><p>They work only when <code class="code docutils literal notranslate"><span class="pre">canopy.shard_replication_factor</span></code> = 1.</p></li>
<li><p>If they can’t connect to a node, they error out.</p></li>
</ul>
<p>Here is an example of using one of the helper functions to list the sizes of all distributed tables:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">logicalrelid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">name</span><span class="p">,</span><span class="w"></span>
<span class="w">       </span><span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">canopy_table_size</span><span class="p">(</span><span class="n">logicalrelid</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">size</span><span class="w"></span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">pg_dist_partition</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>┌───────────────┬───────┐
│     name      │ size  │
├───────────────┼───────┤
│ github_users  │ 39 MB │
│ github_events │ 37 MB │
└───────────────┴───────┘
</pre></div>
</div>
</div>
<div class="section" id="vacuuming-distributed-tables">
<h2>Vacuuming Distributed Tables<a class="headerlink" href="#vacuuming-distributed-tables" title="Permalink to this headline"></a></h2>
<p>In LightDB (and other MVCC databases), an UPDATE or DELETE of a row does not immediately remove the old version of the row. The accumulation of outdated rows is called bloat and must be cleaned to avoid decreased query performance and unbounded growth of disk space requirements. LightDB runs a process called the auto-vacuum daemon that periodically vacuums (aka removes) outdated rows.</p>
<p>It’s not just user queries which scale in a distributed database, vacuuming does too. In LightDB big busy tables have great potential to bloat, both from lower sensitivity to LightDB’s vacuum scale factor parameter, and generally because of the extent of their row churn. Splitting a table into distributed shards means both that individual shards are smaller tables and that auto-vacuum workers can parallelize over different parts of the table on different machines. Ordinarily auto-vacuum can only run one worker per table.</p>
<p>Due to the above, auto-vacuum operations on a Canopy cluster are probably good enough for most cases. However, for tables with particular workloads, or companies with certain “safe” hours to schedule a vacuum, it might make more sense to manually vacuum a table rather than leaving all the work to auto-vacuum.</p>
<p>To vacuum a table, simply run this on the coordinator node:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">VACUUM</span><span class="w"> </span><span class="n">my_distributed_table</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Using vacuum against a distributed table will send a vacuum command to every one of that table’s placements (one connection per placement). This is done in parallel. All <a class="reference external" href="https://www.hs.net/lightdb/docs/html/sql-vacuum.html">options</a> are supported (including the <code class="code docutils literal notranslate"><span class="pre">column_list</span></code> parameter) except for <code class="code docutils literal notranslate"><span class="pre">VERBOSE</span></code>. The vacuum command also runs on the coordinator, and does so before any workers nodes are notified. Note that unqualified vacuum commands (i.e. those without a table specified) do not propagate to worker nodes.</p>
</div>
<div class="section" id="analyzing-distributed-tables">
<h2>Analyzing Distributed Tables<a class="headerlink" href="#analyzing-distributed-tables" title="Permalink to this headline"></a></h2>
<p>LightDB’s ANALYZE command collects statistics about the contents of tables in the database. Subsequently, the query planner uses these statistics to help determine the most efficient execution plans for queries.</p>
<p>The auto-vacuum daemon, discussed in the previous section, will automatically issue ANALYZE commands whenever the content of a table has changed sufficiently. The daemon schedules ANALYZE strictly as a function of the number of rows inserted or updated; it has no knowledge of whether that will lead to meaningful statistical changes. Administrators might prefer to manually schedule ANALYZE operations instead, to coincide with statistically meaningful table changes.</p>
<p>To analyze a table, run this on the coordinator node:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">ANALYZE</span><span class="w"> </span><span class="n">my_distributed_table</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Canopy propagates the ANALYZE command to all worker node placements.</p>
</div>
<div class="section" id="columnar-storage">
<span id="columnar"></span><h2>Columnar Storage<a class="headerlink" href="#columnar-storage" title="Permalink to this headline"></a></h2>
<p>Canopy introduces append-only columnar table storage for analytic and data
warehousing workloads. When columns (rather than rows) are stored contiguously
on disk, data becomes more compressible, and queries can request a subset of
columns more quickly.</p>
<div class="section" id="usage">
<h3>Usage<a class="headerlink" href="#usage" title="Permalink to this headline"></a></h3>
<p>To use columnar storage, specify <code class="docutils literal notranslate"><span class="pre">USING</span> <span class="pre">columnar</span></code> when creating a table:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">contestant</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">handle</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">birthdate</span><span class="w"> </span><span class="nb">DATE</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">rating</span><span class="w"> </span><span class="nb">INT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">percentile</span><span class="w"> </span><span class="k">FLOAT</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">country</span><span class="w"> </span><span class="nb">CHAR</span><span class="p">(</span><span class="mf">3</span><span class="p">),</span><span class="w"></span>
<span class="w">    </span><span class="n">achievements</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">[]</span><span class="w"></span>
<span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">columnar</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>You can also convert between row-based (heap) and columnar storage.</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Convert to row-based (heap) storage</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">alter_table_set_access_method</span><span class="p">(</span><span class="s1">&#39;contestant&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;heap&#39;</span><span class="p">);</span><span class="w"></span>

<span class="c1">-- Convert to columnar storage (indexes will be dropped)</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">alter_table_set_access_method</span><span class="p">(</span><span class="s1">&#39;contestant&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;columnar&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>Canopy converts rows to columnar storage in “stripes” during insertion. Each
stripe holds one transaction’s worth of data, or 150000 rows, whichever is
less.  (The stripe size and other parameters of a columnar table can be changed
with the <a class="reference internal" href="../develop/api_udf.html#alter-columnar-table-set"><span class="std std-ref">alter_columnar_table_set</span></a> function.)</p>
<p>For example, the following statement puts all five rows into the same stripe,
because all values are inserted in a single transaction:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- insert these values into a single columnar stripe</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">contestant</span><span class="w"> </span><span class="k">VALUES</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;1990-01-10&#39;</span><span class="p">,</span><span class="mf">2090</span><span class="p">,</span><span class="mf">97.1</span><span class="p">,</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span><span class="s1">&#39;{a}&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;1990-11-01&#39;</span><span class="p">,</span><span class="mf">2203</span><span class="p">,</span><span class="mf">98.1</span><span class="p">,</span><span class="s1">&#39;XA&#39;</span><span class="p">,</span><span class="s1">&#39;{a,b}&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;1988-11-01&#39;</span><span class="p">,</span><span class="mf">2907</span><span class="p">,</span><span class="mf">99.4</span><span class="p">,</span><span class="s1">&#39;XB&#39;</span><span class="p">,</span><span class="s1">&#39;{w,y}&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;1985-05-05&#39;</span><span class="p">,</span><span class="mf">2314</span><span class="p">,</span><span class="mf">98.3</span><span class="p">,</span><span class="s1">&#39;XB&#39;</span><span class="p">,</span><span class="s1">&#39;{}&#39;</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="s1">&#39;1995-05-05&#39;</span><span class="p">,</span><span class="mf">2236</span><span class="p">,</span><span class="mf">98.2</span><span class="p">,</span><span class="s1">&#39;XC&#39;</span><span class="p">,</span><span class="s1">&#39;{a}&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>It’s best to make large stripes when possible, because Canopy compresses
columnar data separately per stripe. We can see facts about our columnar table
like compression rate, number of stripes, and average rows per stripe by using
<cite>VACUUM VERBOSE</cite>:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">VACUUM</span><span class="w"> </span><span class="k">VERBOSE</span><span class="w"> </span><span class="n">contestant</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span>  <span class="n">statistics</span> <span class="k">for</span> <span class="s2">&quot;contestant&quot;</span><span class="p">:</span>
<span class="n">storage</span> <span class="nb">id</span><span class="p">:</span> <span class="mi">10000000000</span>
<span class="n">total</span> <span class="n">file</span> <span class="n">size</span><span class="p">:</span> <span class="mi">24576</span><span class="p">,</span> <span class="n">total</span> <span class="n">data</span> <span class="n">size</span><span class="p">:</span> <span class="mi">248</span>
<span class="n">compression</span> <span class="n">rate</span><span class="p">:</span> <span class="mf">1.31</span><span class="n">x</span>
<span class="n">total</span> <span class="n">row</span> <span class="n">count</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stripe</span> <span class="n">count</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="n">average</span> <span class="n">rows</span> <span class="n">per</span> <span class="n">stripe</span><span class="p">:</span> <span class="mi">5</span>
<span class="n">chunk</span> <span class="n">count</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="n">containing</span> <span class="n">data</span> <span class="k">for</span> <span class="n">dropped</span> <span class="n">columns</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">zstd</span> <span class="n">compressed</span><span class="p">:</span> <span class="mi">6</span>
</pre></div>
</div>
<p>The output shows that Canopy used the zstd compression algorithm to obtain 1.31x
data compression. The compression rate compares a) the size of inserted data as
it was staged in memory against b) the size of that data compressed in its
eventual stripe.</p>
<p>Because of how it’s measured, the compression rate may or may not match the
size difference between row and columnar storage for a table. The only way
truly find that difference is to construct a row and columnar table that
contain the same data, and compare.</p>
</div>
<div class="section" id="measuring-compression">
<h3>Measuring compression<a class="headerlink" href="#measuring-compression" title="Permalink to this headline"></a></h3>
<p>Let’s create a new example with more data to benchmark the compression savings.</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- first a wide table using row storage</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">perf_row</span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="n">c00</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c01</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c02</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c03</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c04</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c05</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c06</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c07</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c08</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c09</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c10</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c11</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c12</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c13</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c14</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c15</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c16</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c17</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c18</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c19</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c20</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c21</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c22</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c23</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c24</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c25</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c26</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c27</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c28</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c29</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c30</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c31</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c32</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c33</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c34</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c35</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c36</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c37</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c38</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c39</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c40</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c41</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c42</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c43</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c44</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c45</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c46</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c47</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c48</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c49</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c50</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c51</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c52</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c53</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c54</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c55</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c56</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c57</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c58</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c59</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c60</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c61</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c62</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c63</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c64</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c65</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c66</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c67</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c68</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c69</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c70</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c71</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c72</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c73</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c74</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c75</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c76</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c77</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c78</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c79</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c80</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c81</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c82</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c83</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c84</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c85</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c86</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c87</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c88</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c89</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">c90</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c91</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c92</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c93</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c94</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c95</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c96</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c97</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c98</span><span class="w"> </span><span class="nb">int8</span><span class="p">,</span><span class="w"> </span><span class="n">c99</span><span class="w"> </span><span class="nb">int8</span><span class="w"></span>
<span class="p">);</span><span class="w"></span>

<span class="c1">-- next a table with identical columns using columnar storage</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">perf_columnar</span><span class="p">(</span><span class="k">LIKE</span><span class="w"> </span><span class="n">perf_row</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">COLUMNAR</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Fill both tables with the same large dataset:</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">perf_row</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">00500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">01000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">01500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">02000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">02500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">03000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">03500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">04000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">04500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">05000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">05500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">06000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">06500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">07000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">07500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">08000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">08500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">09000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">09500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">11000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">11500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">12000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">12500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">13000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">13500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">14000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">14500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">15000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">15500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">16000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">16500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">17000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">17500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">18000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">18500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">19000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">19500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">20000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">20500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">21000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">21500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">22000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">22500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">23000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">23500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">24000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">24500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">25000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">25500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">26000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">26500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">27000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">27500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">28000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">28500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">29000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">29500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">30000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">30500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">31000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">31500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">32000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">32500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">33000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">33500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">34000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">34500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">35000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">35500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">36000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">36500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">37000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">37500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">38000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">38500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">39000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">39500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">40000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">40500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">41000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">41500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">42000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">42500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">43000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">43500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">44000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">44500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">45000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">45500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">46000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">46500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">47000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">47500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">48000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">48500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">49000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">49500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">50000</span><span class="w"></span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">generate_series</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">50000000</span><span class="p">)</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">perf_columnar</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">00500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">01000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">01500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">02000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">02500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">03000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">03500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">04000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">04500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">05000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">05500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">06000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">06500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">07000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">07500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">08000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">08500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">09000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">09500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">10500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">11000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">11500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">12000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">12500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">13000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">13500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">14000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">14500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">15000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">15500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">16000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">16500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">17000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">17500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">18000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">18500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">19000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">19500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">20000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">20500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">21000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">21500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">22000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">22500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">23000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">23500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">24000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">24500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">25000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">25500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">26000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">26500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">27000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">27500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">28000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">28500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">29000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">29500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">30000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">30500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">31000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">31500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">32000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">32500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">33000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">33500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">34000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">34500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">35000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">35500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">36000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">36500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">37000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">37500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">38000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">38500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">39000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">39500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">40000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">40500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">41000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">41500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">42000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">42500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">43000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">43500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">44000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">44500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">45000</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">45500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">46000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">46500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">47000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">47500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">48000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">48500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">49000</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">49500</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">50000</span><span class="w"></span>
<span class="w">  </span><span class="k">FROM</span><span class="w"> </span><span class="n">generate_series</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">50000000</span><span class="p">)</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>

<span class="k">VACUUM</span><span class="w"> </span><span class="p">(</span><span class="k">FREEZE</span><span class="p">,</span><span class="w"> </span><span class="k">ANALYZE</span><span class="p">)</span><span class="w"> </span><span class="n">perf_row</span><span class="p">;</span><span class="w"></span>
<span class="k">VACUUM</span><span class="w"> </span><span class="p">(</span><span class="k">FREEZE</span><span class="p">,</span><span class="w"> </span><span class="k">ANALYZE</span><span class="p">)</span><span class="w"> </span><span class="n">perf_columnar</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>For this data, you can see a compression ratio of better than 8X in the columnar table.</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="s1">&#39;perf_row&#39;</span><span class="p">)</span><span class="o">::</span><span class="nb">numeric</span><span class="o">/</span><span class="w"></span>
<span class="w">       </span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="s1">&#39;perf_columnar&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">compression_ratio</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span>
 <span class="n">compression_ratio</span>
<span class="o">--------------------</span>
 <span class="mf">8.0196135873627944</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline"></a></h3>
<p>Columnar storage works well with table partitioning. For an example, see
<a class="reference internal" href="../use_cases/timeseries.html#columnar-example"><span class="std std-ref">Archiving with Columnar Storage</span></a>.</p>
</div>
<div class="section" id="gotchas">
<h3>Gotchas<a class="headerlink" href="#gotchas" title="Permalink to this headline"></a></h3>
<ul>
<li><p>Columnar storage compresses per stripe. Stripes are created per transaction,
so inserting one row per transaction will put single rows into their own
stripes. Compression and performance of single row stripes will be worse than
a row table. Always insert in bulk to a columnar table.</p></li>
<li><p>If you mess up and columnarize a bunch of tiny stripes, you can use VACUUM command to be able to
reorganize columnar stripes</p>
<div class="highlight-postgresql notranslate"><div class="highlight"><pre><span></span><span class="k">BEGIN</span><span class="p">;</span><span class="w"></span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">foo_compacted</span><span class="w"> </span><span class="p">(</span><span class="k">LIKE</span><span class="w"> </span><span class="n">foo</span><span class="p">)</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">columnar</span><span class="p">;</span><span class="w"></span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">foo_compacted</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span><span class="w"></span>
<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span><span class="w"></span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">foo_compacted</span><span class="w"> </span><span class="k">RENAME</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span><span class="w"></span>
<span class="k">COMMIT</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>Fundamentally non-compressible data can be a problem, although it can still
be useful to use columnar so that less is loaded into memory when selecting
specific columns.</p></li>
<li><p>On a partitioned table with a mix of row and column partitions, updates must
be carefully targeted or filtered to hit only the row partitions.</p>
<blockquote>
<div><ul class="simple">
<li><p>If the operation is targeted at a specific row partition (e.g. <cite>UPDATE p2
SET i = i + 1</cite>), it will succeed; if targeted at a specified columnar
partition (e.g. <cite>UPDATE p1 SET i = i + 1</cite>), it will fail.</p></li>
<li><p>If the operation is targeted at the partitioned table and has a WHERE
clause that excludes all columnar partitions (e.g. <cite>UPDATE parent SET i = i
+ 1 WHERE timestamp = ‘2020-03-15’</cite>), it will succeed.</p></li>
<li><p>If the operation is targeted at the partitioned table, but does not
exclude all columnar partitions, it will fail; even if the actual data to
be updated only affects row tables (e.g. <cite>UPDATE parent SET i = i + 1 WHERE
n = 300</cite>).</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="limitations">
<h3>Limitations<a class="headerlink" href="#limitations" title="Permalink to this headline"></a></h3>
<p>Future versions of Canopy will incrementally lift the current limitations:</p>
<ul class="simple">
<li><p>Append-only (no UPDATE/DELETE support)</p></li>
<li><p>No space reclamation (e.g. rolled-back transactions may still consume disk space)</p></li>
<li><p>Support for hash and btree indices only</p></li>
<li><p>No index scans, or bitmap index scans</p></li>
<li><p>No tidscans</p></li>
<li><p>No sample scans</p></li>
<li><p>No TOAST support (large values supported inline)</p></li>
<li><p>No support for ON CONFLICT statements (except DO NOTHING actions with no target specified).</p></li>
<li><p>No support for tuple locks (SELECT … FOR SHARE, SELECT … FOR UPDATE)</p></li>
<li><p>No support for serializable isolation level</p></li>
<li><p>Support for LightDB server versions 12+ only</p></li>
<li><p>No support for foreign keys, unique constraints, or exclusion constraints</p></li>
<li><p>No support for logical decoding</p></li>
<li><p>No support for intra-node parallel scans</p></li>
<li><p>No support for AFTER … FOR EACH ROW triggers</p></li>
<li><p>No UNLOGGED columnar tables</p></li>
<li><p>No TEMPORARY columnar tables</p></li>
</ul>
</div>
</div>
</div>




           </div>
          </div>
        </div>
        <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cluster_management.html" class="btn btn-neutral float-left" title="Cluster Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../performance/performance_tuning.html" class="btn btn-neutral float-right" title="Query Performance Tuning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Hundsun Technologies Inc.</p>
  </div>

   

</footer>
      </div>

    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-32858865-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-32858865-1', {
          'anonymize_ip': false,
      });
    </script>
   

  
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("4002524638");
  </script>

  

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js'></script>

  <script type="text/javascript">
    $(document).ready(function() {
      /* Uses global window.g_cookieConsentId defined in the <head> */

      var consentValue = 'Consented';

      var clickConsent = function () {
        if ($("#consentBox").is(":visible")) {
          if (typeof(window.yett) == 'object' &&
              typeof(window.yett.unblock) == 'function') {
            window.yett.unblock();
          } else {
            console.log("clickConsent: Unable to access window.yett.unblock()");
          }
          // "slideUp" means "hide," it is not a direction of movement
          $("#consentBox").slideUp("linear");
          $.cookie(window.g_cookieConsentId, consentValue, {
            expires: 365,
            path: '/'
          });
          if (typeof(ga) == 'function') {
            ga('set', 'allowAdFeatures', true);
            ga('send', 'event', 'cookie consent', 'accept', window.location.href);
          } else {
            console.log("clickConsent: Unable to access ga()");
          }
        }
      };

      // continuing to interact with the page consents to cookies
      $("a:not(#cookiesLink), button, iframe, input, [data-toggle*='wy-nav-top'], [data-toggle*='rst-current-version']").on(
        "click", clickConsent
      );

      if ($.cookie(window.g_cookieConsentId) != consentValue) {
        // "slideDown" means "show," it's not a direction of movement
        $("#consentBox").slideDown("linear");
      };
    });
  </script>

</body>
</html>